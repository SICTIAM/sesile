{% extends 'SesileMainBundle:Default:index.html.twig' %}

{% block content %}
    <div class="bloc_page">
        {% if classeur.isValidable(app.user.id) %}
            {% if classeur.isSignable(app.user.id) %}
                <form class="form_action" id="signform">
                    <button type="submit" class="btn btn-success">Valider et Signer</button>
                    <input type="hidden" value="{{ classeur.id }}" name="id"/>
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div id='modalcontent' class="modal-content">

                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                </form>
            {% else %}
                <form class="form_action" action="{{ path("classeur_valider") }}" method="post">
                    <button type="submit" class="btn btn-success">Valider</button>
                    <input type="hidden" value="{{ classeur.id }}" name="id"/>
                </form>
            {% endif %}

            <form class="form_action" action="{{ path("classeur_refuser") }}" method="post">
                <button type="submit" class="btn btn-danger">Refuser</button>
                <input type="hidden" value="{{ classeur.id }}" name="id"/>
            </form>
        {% endif %}

        {% if retractable %}
            <form class="form_action" action="{{ path("classeur_retracter") }}" method="post">
                <button type="submit" class="btn btn-warning">Se r&eacute;tracter</button>
                <input type="hidden" value="{{ classeur.id }}" name="id"/>
            </form>
        {% endif %}

        {% if classeur.isModifiable(app.user.id) %}
            <button id="btn_modifier" type="button" class="btn btn-info">Modifier</button>
        {% endif %}

        {% if classeur.isSupprimable(app.user.id) %}
            <form class="form_action pull-right" action="{{ path("classeur_supprimer") }}" method="post">
                <button type="submit" class="btn btn-danger">Supprimer</button>
                <input type="hidden" value="{{ classeur.id }}" name="id"/>
            </form>
        {% endif %}
        <br>

        <form action="{{ path("classeur_retracter") }}" method="post">
            <div class="titre_form_element">Titre</div>
            <input class="form-control" id="name" name="name" disabled placeholder="Nom" value="{{ classeur.nom }}">
            <br>

            <div class="titre_form_element">Description</div>
            <textarea class="form-control" rows="3" name="desc" disabled id="desc">{{ classeur.description }}</textarea>
            <br>

            <div class="titre_form_element">Documents</div>
            <div id="documentcontent"></div>
            <br>

            <div class="titre_form_element">Circuit</div>
            <div id="circuitcontent"></div>
            <br>





            {% block extraform %}
            {% endblock %}

            <div>
                <br/>
                <button type="submit" id="enregistrer_modif" style="display: none;" class="btn btn-success">Enregistrer
                    les modifications
                </button>
            </div>
        </form>






        <script type="application/javascript">
            $("#btn_modifier").click(function () {
                $("#name, #desc").removeAttr("disabled");
                $("#enregistrer_modif").show();
                enableUploads();

            });

            $(document).ready(function () {
                $('#documentcontent').load(Routing.generate('edit_document_for_classeur', {id: {{ classeur.id }}}));
                $('#signform').submit(function(e){

                    $.ajax('{{ path('signform', {'id':classeur.id}) }}',
                            {
                                method: 'GET',
                                success: function (html) {

                                    $('#modalcontent').html(html);


                                    $('#myModal').modal({
                                        backdrop: 'static'
                                    });

                                }

                            }
                    );


                    e.preventDefault();
                    e.stopImmediatePropagation();
                    return false;

                });
            });




        </script>
    </div>
{% endblock %}

{% block losjavascriptos %}
    <script type="text/javascript" src="http://www.java.com/js/deployJava.js">
    </script>
{% endblock %}
