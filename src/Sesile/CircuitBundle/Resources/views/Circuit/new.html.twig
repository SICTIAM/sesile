<div class="row">
    <div class="col-lg-12">
        <div id="contetapes">
            {% for etape in service %}

                <div class="col-lg-2 well etapes-circuit">
                    <div class="text-center"><h4>Etape de validation {{ etape.id }}</h4></div>
                    {#<input type="hidden" name="etape_id" value="{{ etape.id }}">#}
                    <select class="selusers" multiple="multiple" style="width: 100%" data-etape="{{ etape.id }}">
                        <optgroup label="Groupes d'utilisateurs">
                            {% for userPack in userPacks %}
                                <option value="userpack-{{ userPack.id }}" {% if userPack in etape.userPacks %} selected{% endif %} data-type="groupe">{{ userPack.nom }}</option>
                            {% endfor %}
                        </optgroup>
                        <optgroup label="utilisateurs">
                            {% for user in users %}
                                <option value="user-{{ user.id }}" data-etape="{{ etape.id }}" data-type="user" {% if user in etape.users %} selected{% endif %}>{{ user.prenom }} {{ user.nom }}</option>
                            {% endfor %}
                        </optgroup>
                    </select>
                    <button type="button" class="btn btn-danger btn-suppetape" id="suppetape"><span class="glyphicon glyphicon-minus-sign"></span> Supprimer cette étape</button>
                </div>
            {% endfor %}
        </div>
        <div class="col-lg-2 text-center">
            <input type="hidden" name="valeurs" id="valeurs">
            <button type="button" class="btn btn-info btn-ajout-etape" id="addetape"><span class="glyphicon glyphicon-plus-sign"></span><br>Ajouter une étape</button>
        </div>
    </div>
</div>

<script type="text/javascript" src="{{ asset('/js/jquery-ui.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('/js/circuit_etape.js') }}"></script>
<link rel="stylesheet" href="{{ asset('/css/circuit.css') }}"/>
<script>
    $(document).ready(function() {

        $(document).on('click', '#addetape', function (e) {
            /*
             A chaque fois qu'on clicque sur le bouton bleu une nouvelle etape de validation se crée
             */
            $('#contetapes').append('' +
            '<div class="col-lg-2 well etapes-circuit"><div class="text-center"><h4>Etape de validation</h4></div><select class="selusers" multiple="multiple" style="width: 100%" data-etape="0"><optgroup label="Groupes d\'utilisateurs">{% for userPack in userPacks %}<option value="userpack-{{ userPack.id }}" data-type="groupe">{{ userPack.nom }}</option>{% endfor %}</optgroup><optgroup label="utilisateurs">{% for user in users %}<option value="user-{{ user.id }}" data-type="user">{{ user.prenom }} {{ user.nom }}</option>{% endfor %}</optgroup></select><button type="button" class="btn btn-danger btn-suppetape" id="suppetape"><span class="glyphicon glyphicon-minus-sign"></span> Supprimer cette étape</button></div>');
            $("select.selusers").select2();

            e.stopImmediatePropagation();

        });
    });
</script>
{#

<link rel="stylesheet" href="{{ asset('/css/circuit.css') }}"/>
<div class="top_selects_circuits">

    <div class="selects_circuit">
        <div class="titre_select">
            <label class="nametitle" id="users_complete">
                <span class="glyphicon glyphicon-search"></span>
                &nbsp;&nbsp;Utilisateurs&nbsp;&nbsp;</label>
            <input class="nameinput" type="text" id="circuit-search" autocomplete="off">
        </div>
        <div id="users_list">
            {% for user in users %}
                <p class="users-search" data-id="{{ user.id }}" data-img="{{ user.path }}">{{ user.nom }} {{ user.prenom }}</p>
            {% endfor %}
        </div>
        <span id="useradd_btn" class="glyphicon glyphicon-chevron-down"></span>
    </div>

</div>


<div id="circuit_editor">
    <div class="titre_select">
    </div>
    <div id="circuit">
        <img id="debut_circuit" src="{{ asset("/images/buttonlist.png") }}"/>
    </div>
</div>


<script type="text/javascript">
    $(".nameinput").focus(function () {
        $(".glyphicon-search-blue").removeClass("glyphicon-search-blue");
        $(this).prev("label").addClass("glyphicon-search-blue");
    });

    $("#users_list p, #circuits_list p").click(function () {
        $(this).siblings(".list_selected_element").removeClass("list_selected_element");
        $(this).addClass("list_selected_element");
    });

    var path = "{{ asset(upload_path) }}";
</script>
<script type="text/javascript" src="{{ asset('/js/jquery-ui.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('/js/circuit.js') }}"></script>
<script type="text/javascript" src="{{ asset('/js/autocomplete.js') }}"></script>
<script type="text/javascript">
    var users_list = new Array();
    $("#users_list p").each(function () {
        users_list.push($(this).text());
    });
    // $("#users_complete").autocomplete({ lookup: users_list });
</script>
#}
